{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Panels test</title>
    <!--<link rel="stylesheet" type="text/css" href="{% static 'prueba/test.css' %}" />-->



    <link rel="stylesheet" type="text/css" href="{% static 'monocle/styles/monocore.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'monocle/styles/monoctrl.css' %}" />



    <style type="text/css">
      .readerInfo {
        width: 300px;
        float: left;
        padding-right: 20px;
      }
      .reader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }
      #part1, #part2 {
        display: none;
      }
    </style>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="   crossorigin="anonymous"></script>
    <script type='text/javascript' src="{% static 'js/clickable.js' %}"></script>
    <script type="text/javascript" src="{% static 'monocle/scripts/monocore.js' %}"></script>
    <script type="text/javascript" src="{% static 'monocle/scripts/monoctrl.js' %}"></script>




    <script type="text/javascript">

    {% load static %}
    Monocle.DEBUG = true;
    function htmlreplace(a, b, element, last_node, first_node) {
                            if (!element) element = document.body;
                            var nodes = element.childNodes;
                            for (var n= first_node; n<last_node; n++) {
                                if (nodes[n].nodeType == Node.TEXT_NODE) {
                                    var r = new RegExp('\\b' + a + '\\b', 'gi');
                                    nodes[n].textContent = nodes[n].textContent.replace(r , b);
                                    } else {
                                        htmlreplaceelement(a, b, nodes[n], last_node, first_node);
                                        }
                                }
                            }
    function htmlreplaceelement(a, b, element, last_node, first_node) {
                            if (!element) element = document.body;
                            var nodes = element.childNodes;
                            for (var n= 0; n<nodes.length; n++) {
                                if (nodes[n].nodeType == Node.TEXT_NODE) {
                                    var r = new RegExp('\\b' + a + '\\b', 'gi');
                                    nodes[n].textContent = nodes[n].textContent.replace(r , b);
                                    } else {
                                        htmlreplaceelement(a, b, nodes[n], last_node, first_node);
                                        }
                                }
                            }
    function textSelected(evt) {
          console.log("Selection: "+evt.m.string);
          console.log(evt.m);
          var st = document.getElementById('statusSelect');
          var sel = evt.m.string;
          //st.innerHTML = sel;
          //st.style.visibility = 'visible';
          //copypaste
          sel = sel.replace(/ /g,'')
          var datoajax = {palabra:sel.toLowerCase()};
          console.log(first_child);
	                   console.log(last_child);
          console.log(datoajax);
          $.ajax({
            url: '/wordselectionajax/' ,
            type: 'GET', // This is the default though, you don't actually need to always mention it
            data: datoajax,
            success: function(data) {
                    console.log(data);
                    console.log(data.spanish_text);
                    if(data.length > 0 ){
                    var replacement = data[0].spanish_text;
                    var iframe = document.getElementsByClassName("monelem_component");
                        var innerDoc1 = iframe[0].contentDocument.getElementsByClassName("CalibreEbookContent");
                        var innerDoc = innerDoc1[0];
                    htmlreplace(sel, replacement, innerDoc, last_child, first_child);
                    }
            },
            failure: function(data) {
                alert('Got an error dude');
            }
        });
        }
        function textDeselected(evt) {
          console.log("Deselection.");
          var st = document.getElementById('statusSelect');
          st.style.visibility = 'hidden';
        }
    var placeSaver = new Monocle.Controls.PlaceSaver('placesaver');
    place_book = placeSaver.savedPlace()    //to fixed problems with the placesaver
<<<<<<< HEAD
    if(isNaN(place_book)==1){
    if(place_book.percent==null){place_book.percent=0}
    if(isNaN(place_book.percent)){place_book.percent=0}
    }
    var book_config = { panels: Monocle.Panels.Marginal, flipper: Monocle.Flippers.Instant, place: place_book }; // , place: place_book
=======

    if(isNaN(place_book)==1){

    if(place_book.percent==null){place_book.percent=0}
    if(isNaN(place_book.percent)){place_book.percent=0}
    }
    var book_config = { panels: Monocle.Panels.Marginal, flipper: Monocle.Flippers.Instant , place: place_book};
>>>>>>> origin/master
    console.log(book_config);
    var bookData = {
        getComponents: function () {
        return [
<<<<<<< HEAD
            '{% static '/static/components/part0000.html' %}',
            '{% static '/static/components/part0001.html' %}',
            '{% static '/static/components/part0002.html' %}',
            '{% static '/static/components/part0003.html' %}',
            '{% static '/static/components/part0004.html' %}',
            '{% static '/static/components/part0005.html' %}',
            '{% static '/static/components/part0006.html' %}',
            '{% static '/static/components/part0007.html' %}',
            '{% static '/static/components/part0008.html' %}',
            '{% static '/static/components/part0009.html' %}',
            '{% static '/static/components/part0010.html' %}',
            '{% static '/static/components/part0011.html' %}',
            '{% static '/static/components/part0012.html' %}',
            '{% static '/static/components/part0013.html' %}',
            '{% static '/static/components/part0014.html' %}',
            '{% static '/static/components/part0015.html' %}',
            '{% static '/static/components/part0016.html' %}',
            '{% static '/static/components/part0017.html' %}',
            '{% static '/static/components/part0018.html' %}',
            '{% static '/static/components/part0019.html' %}',
            '{% static '/static/components/part0020.html' %}',
            '{% static '/static/components/part0021.html' %}',
            '{% static '/static/components/part0022.html' %}',
            '{% static '/static/components/part0023.html' %}',
            '{% static '/static/components/part0024.html' %}',
            '{% static '/static/components/part0025.html' %}',
            '{% static '/static/components/part0026.html' %}',
            '{% static '/static/components/part0027.html' %}',
            '{% static '/static/components/part0028.html' %}',
            '{% static '/static/components/part0029.html' %}',
            '{% static '/static/components/part0030.html' %}',
            '{% static '/static/components/part0031.html' %}',
            '{% static '/static/components/part0032.html' %}',
            '{% static '/static/components/part0033.html' %}',
            '{% static '/static/components/part0034.html' %}',
            '{% static '/static/components/part0035.html' %}',
            '{% static '/static/components/part0036.html' %}',
            '{% static '/static/components/part0037.html' %}',
            '{% static '/static/components/part0038.html' %}',
            '{% static '/static/components/part0039.html' %}',
            '{% static '/static/components/part0040.html' %}',
            '{% static '/static/components/part0041.html' %}',
            '{% static '/static/components/part0042.html' %}',
            '{% static '/static/components/part0043.html' %}',
            '{% static '/static/components/part0044.html' %}',
            '{% static '/static/components/part0045.html' %}',
            '{% static '/static/components/part0046.html' %}',
            '{% static '/static/components/part0047.html' %}',
            '{% static '/static/components/part0048.html' %}',
            '{% static '/static/components/part0049.html' %}',
            '{% static '/static/components/part0050.html' %}',
            '{% static '/static/components/part0051.html' %}',
            '{% static '/static/components/part0052.html' %}',
            '{% static '/static/components/part0053.html' %}',
            '{% static '/static/components/part0054.html' %}',
            '{% static '/static/components/part0055.html' %}',
            '{% static '/static/components/part0056.html' %}',
            '{% static '/static/components/part0057.html' %}',
            '{% static '/static/components/part0058.html' %}',
            '{% static '/static/components/part0059.html' %}',
            '{% static '/static/components/part0050.html' %}',
            '{% static '/static/components/part0061.html' %}',
            '{% static '/static/components/part0062.html' %}',
            '{% static '/static/components/part0063.html' %}',
            '{% static '/static/components/part0064.html' %}',
            '{% static '/static/components/part0065.html' %}',
            '{% static '/static/components/part0066.html' %}',
            '{% static '/static/components/part0067.html' %}',
            '{% static '/static/components/part0068.html' %}',
            '{% static '/static/components/part0069.html' %}',
            '{% static '/static/components/part0070.html' %}',
            '{% static '/static/components/part0071.html' %}',
            '{% static '/static/components/part0072.html' %}',
            '{% static '/static/components/part0073.html' %}',
            '{% static '/static/components/part0074.html' %}',
            '{% static '/static/components/part0075.html' %}',
            '{% static '/static/components/part0076.html' %}',
            '{% static '/static/components/part0077.html' %}',
            '{% static '/static/components/part0078.html' %}',
            '{% static '/static/components/part0079.html' %}',
            '{% static '/static/components/part0080.html' %}'
=======
            '/static/components/part0000.html',
            '/static/components/part0001.html',
            '/static/components/part0002.html',
            '/static/components/part0003.html',
            '/static/components/part0004.html',
            '/static/components/part0005.html',
            '/static/components/part0006.html',
            '/static/components/part0007.html',
            '/static/components/part0008.html',
            '/static/components/part0009.html',
            '/static/components/part0010.html',
            '/static/components/part0011.html',
            '/static/components/part0012.html',
            '/static/components/part0013.html',
            '/static/components/part0014.html',
            '/static/components/part0015.html',
            '/static/components/part0016.html',
            '/static/components/part0017.html',
            '/static/components/part0018.html',
            '/static/components/part0019.html',
            '/static/components/part0020.html',
            '/static/components/part0021.html',
            '/static/components/part0022.html',
            '/static/components/part0023.html',
            '/static/components/part0024.html',
            '/static/components/part0025.html',
            '/static/components/part0026.html',
            '/static/components/part0027.html',
            '/static/components/part0028.html',
            '/static/components/part0029.html',
            '/static/components/part0030.html',
            '/static/components/part0031.html',
            '/static/components/part0032.html',
            '/static/components/part0033.html',
            '/static/components/part0034.html',
            '/static/components/part0035.html',
            '/static/components/part0036.html',
            '/static/components/part0037.html',
            '/static/components/part0038.html',
            '/static/components/part0039.html',
            '/static/components/part0040.html',
            '/static/components/part0041.html',
            '/static/components/part0042.html',
            '/static/components/part0043.html',
            '/static/components/part0044.html',
            '/static/components/part0045.html',
            '/static/components/part0046.html',
            '/static/components/part0047.html',
            '/static/components/part0048.html',
            '/static/components/part0049.html',
            '/static/components/part0050.html',
            '/static/components/part0051.html',
            '/static/components/part0052.html',
            '/static/components/part0053.html',
            '/static/components/part0054.html',
            '/static/components/part0055.html',
            '/static/components/part0056.html',
            '/static/components/part0057.html',
            '/static/components/part0058.html',
            '/static/components/part0059.html',
            '/static/components/part0060.html',
            '/static/components/part0061.html',
            '/static/components/part0062.html',
            '/static/components/part0063.html',
            '/static/components/part0064.html',
            '/static/components/part0065.html',
            '/static/components/part0066.html',
            '/static/components/part0067.html',
            '/static/components/part0068.html',
            '/static/components/part0069.html',
            '/static/components/part0070.html',
            '/static/components/part0071.html'
>>>>>>> origin/master
            ];
        },
        getContents: function () {
        return [
<<<<<<< HEAD
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0000.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0001.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0002.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0003.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0004.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0005.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0006.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0007.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0008.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0009.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0010.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0011.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0012.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0013.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0014.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0015.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0016.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0017.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0018.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0019.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0020.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0021.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0022.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0023.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0024.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0025.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0026.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0027.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0028.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0029.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0030.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0031.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0032.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0033.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0034.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0035.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0036.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0037.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0038.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0039.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0040.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0041.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0042.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0043.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0044.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0045.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0046.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0047.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0048.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0049.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0050.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0051.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0052.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0053.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0054.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0055.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0056.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0057.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0058.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0059.html' %}",
                },
                {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0060.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0061.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0062.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0063.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0064.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0065.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0066.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0067.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0068.html' %}",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0069.html' %}",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "{% static '/letlassen_app/static/components/part0070.html' %}",
                }
=======

            {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0000.html",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0001.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0002.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0003.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0004.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0005.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0006.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0007.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0008.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0009.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0010.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0011.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0012.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0013.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0014.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0015.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0016.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0017.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0018.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0019.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0020.html",
                },

            {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0021.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0022.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0023.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0024.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0025.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0026.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0027.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0028.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0029.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0030.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0031.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0032.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0033.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0034.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0035.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0036.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0037.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0038.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0039.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0040.html",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0041.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0042.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0043.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part00044.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0045.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0046.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0047.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0048.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0049.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0050.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0051.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0052.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0053.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0054.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0055.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0056.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0057.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0058.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0059.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0060.html",
                },
            {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0061.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0062.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0063.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0064.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0065.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0066.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0067.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0068.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0069.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0070.html",
                },
                 {
            title: "The Hau3nte1d Hou8se",
            src: "/static/components/part0071.html",
                }

>>>>>>> origin/master

      ]
    },
    getComponent: function (componentId) {
      return { url: componentId }
    },
    getMetaData: function(key) {
      return {
        title: "Three Ghost Stories",
        creator: "Charles Dickens"
      }[key];
    }
  }
      // Initialize the reader element.
        Monocle.Events.listen(
            window,
            'load',
            function () {
                window.reader2 = Monocle.Reader(
                'marginal',
                bookData,
                book_config,
                function(rdr) {
                    window.reader2 = rdr;
                    alertIfComponentNotFound(rdr);
                    rdr.listen('monocle:selection', textSelected);
                    rdr.listen('monocle:deselection', textDeselected);
                    rdr.addControl(placeSaver, 'invisible');
                    /* PAGE NUMBER RUNNING HEAD */
                    var pageNumber = {
                        runners: [],
                        createControlElements: function (page) {
                            var cntr = document.createElement('div');
                            cntr.className = "pageNumber";
                            var runner = document.createElement('div');
                            runner.className = "runner";
                            cntr.appendChild(runner);
                            this.runners.push(runner);
                            this.update(page);
                            return cntr;
                        },
                    update: function (page, pageNumber) {
                        if (pageNumber) {
                        this.runners[page.m.pageIndex].innerHTML = pageNumber;
                            }
                        }
                    }
                    /* box_scrapping */
                    var box_scrapping = {
                        createStencil: function (rdr) {
                            var stencil = new Monocle.Controls.Stencil(rdr);
                            rdr.addControl(stencil);
                            // This line is useful mostly for testing:
                            // it highlights the stencil's link cutouts.
                            //stencil.toggleHighlights();
                            //stencil.draw();
                            return stencil;
                        },
                    getVisibleElem: function (rdr) {
                        var pageDiv =rdr.visiblePages()[0];
                        //stencil.addBehavior({maskTagName: "p"});
                        var boxes = stencil.boxesForComponent(pageDiv);
                        var text = new Array();
                        var text_send = new Array();
                        var text_send_string ="";
                        offset = stencil.getOffset(pageDiv);
                        visibility = false; //to enter the loop
                        n=0;
                        i=0;
                        while(visibility == false){
                            visibility = stencil.boxVisible(boxes[n] , offset.l, offset.l + offset.w);
                            n++;
                            }
                        text[0] = boxes[n].element.innerHTML;
                        console.log(text[0]);
                        while(visibility == true){
                            if(boxes[n].element.innerHTML != boxes[n-1].element.innerHTML){
                                //if(boxes[n].element.innerHTML[1] != text[i][1]){
                                //console.log(text[i][1]);
                                    visibility = stencil.boxVisible(boxes[n] , offset.l, offset.l + offset.w);
                                    n++;
                                    i++;
                                    text[i] = boxes[n].element.innerHTML;
                                    console.log(n);
                                   // }
                                }
                            else{
                                visibility = stencil.boxVisible(boxes[n] , offset.l, offset.l + offset.w);
                                n++;
                                console.log(n);
                                }
                            }
                        console.log("text");
                        console.log(text);
                        text_send[0]=text[0]
                        n=0;
                        for(i = 1; i < text.length; i++){
                            if(text[i][1]==text[i-1][1]){
                                console.log("repeated");
                            }
                            else{
                                n++;
                                text_send[n]=text[i];
                            }
                        }
                         for(i = 0; i < text_send.length; i++){
                            text_send_string = text_send_string + text_send[i]
                         }
                        var url      = window.location.href;
	                    console.log(url);
	                    var iframe = document.getElementsByClassName("monelem_component");
                        var innerDoc1 = iframe[0].contentDocument.getElementsByClassName("calibreEbookContent");
                        var innerDoc = innerDoc1[0];
                        childNo = innerDoc.childNodes;
                        console.log("location of text");
	                    for (j=0; j < childNo.length; j++){
	                       text_con = childNo[j].textContent;
	                       if (text_con.length > 6){
                                text_match = text_send[0].indexOf(childNo[j].innerHTML);
                                if (text_match != -1){
                                  first_child = j
                                     }
	                            }
	                    }
	                    for (j=0; j < childNo.length; j++){
	                       text_con = childNo[j].textContent;
	                       if (text_con.length > 6){
                                text_match = text_send[text_send.length-1].indexOf(childNo[j].innerHTML);
                                if (text_match != -1){
                                  last_child = j
                                     }
	                            }
	                    }
	                   console.log("first and last");
	                   console.log(first_child);
	                   console.log(last_child);
                        var datoajax = {text: text_send_string,  urlsend:url};
                        $.ajax({
                            url: '/bookscrapping/' ,
                            type: 'GET', // This is the default though, you don't actually need to always mention it
                            traditional: true,
                            data: datoajax,
                            success: function(data) {
                                console.log("success");
                                console.log(data);
                                var iframe = document.getElementsByClassName("monelem_component");
                                var innerDoc1 = iframe[0].contentDocument.getElementsByClassName("calibreEbookContent");
                                var innerDoc = innerDoc1[0];
                                console.log(innerDoc);
                                //!!CAUTION!! ELEMENT DELETED
                                var monelem_controls_stencil_container = document.getElementsByClassName("monelem_controls_stencil_container");
                                while (monelem_controls_stencil_container[0].hasChildNodes()) {
                                    monelem_controls_stencil_container[0].removeChild(monelem_controls_stencil_container[0].firstChild);
                                    }
                                    console.log("cleaned");
                                for(i = 1; i < data.length; i++){
                                    if(data[i].words_status =="LK"){
                                        replacement = data[i].english_text;
                                        htmlreplace(data[i].spanish_text, replacement, innerDoc, last_child, first_child)
                                    }
                                    if(data[i].words_status =="HK"){
                                        replacement = data[i].english_text;
                                        htmlreplace(data[i].spanish_text, replacement, innerDoc, last_child, first_child)
                                    }
                                    if(data[i].words_status =="ST"){
                                        replacement = data[i].spanish_text + "·" + data[i].english_text;
                                        htmlreplace(data[i].spanish_text, replacement, innerDoc, last_child, first_child)
                                    }
                                    if(data[i].words_status =="UN"){
                                        replacement = data[i].spanish_text + "·" + data[i].english_text;
                                        htmlreplace(data[i].spanish_text, replacement, innerDoc, last_child, first_child)
                                    }
                                }
                                },
                            failure: function(data) {
                                alert('Got an error dude');
                                }
                        });
                        function htmlreplace(a, b, element, last_node, first_node) {
                            if (!element) element = document.body;
                            var nodes = element.childNodes;
                            for (var n= first_node; n<last_node; n++) {
                                if (nodes[n].nodeType == Node.TEXT_NODE) {
                                    var r = new RegExp('\\b' + a + '\\b', 'gi');
                                    nodes[n].textContent = nodes[n].textContent.replace(r , b);
                                    } else {
                                        htmlreplaceelement(a, b, nodes[n], last_node, first_node);
                                        }
                                }
                            }
                        function htmlreplaceelement(a, b, element, last_node, first_node) {
                            if (!element) element = document.body;
                            var nodes = element.childNodes;
                            for (var n= 0; n<nodes.length; n++) {
                                if (nodes[n].nodeType == Node.TEXT_NODE) {
                                    var r = new RegExp('\\b' + a + '\\b', 'gi');
                                    nodes[n].textContent = nodes[n].textContent.replace(r , b);
                                    } else {
                                        htmlreplaceelement(a, b, nodes[n], last_node, first_node);
                                        }
                                }
                            }
                        return;
                        }
                    }
                stencil = box_scrapping.createStencil(rdr);
                box_scrapping.getVisibleElem(rdr);
                reader2.addControl(pageNumber, 'page');
                reader2.listen(
                    'monocle:turn',
                    function (evt) {
                        box_scrapping.getVisibleElem(rdr);
                        $.ajax({
                            url: '/wordajax/' ,
                            type: 'GET', // This is the default though, you don't actually need to always mention it
                            data: datoajax,
                            success: function(data) {
                                console.log("success");
                                },
                            failure: function(data) {
                                alert('Got an error dude');
                                }
                        });
                    }
                );
                 var iframe = document.getElementsByClassName("monelem_component");
                        var innerDoc1 = iframe[0].contentDocument.getElementsByClassName("calibreEbookContent");
                        var innerDoc = innerDoc1[0].children;;
                 //var iframe = document.getElementsByClassName("monelem_component");
    //var innerDoc = iframe[0].contentDocument.body.children;
    $(innerDoc).mouseup(function(e){
        console.log('click');
        var clicked = $(e.currentTarget);
        console.log(window.frames.length);
         s = window.frames[0].getSelection();
         var range = s.getRangeAt(0);
         var node = s.anchorNode;
         while(range.toString().indexOf(' ') != 0) {
            range.setStart(node,(range.startOffset -1));
         }
         range.setStart(node, range.startOffset +1);
         do{
           range.setEnd(node,range.endOffset + 1);
        }while(range.toString().indexOf(' ') == -1 && range.toString().trim() != '');
        var str = range.toString().trim();
        console.log(str);
        sel =str
        sel = sel.replace(/ /g,'')
          var datoajax = {palabra:sel.toLowerCase()};
          console.log(first_child);
	                   console.log(last_child);
          console.log(datoajax);
          $.ajax({
            url: '/wordselectionajax/' ,
            type: 'GET', // This is the default though, you don't actually need to always mention it
            data: datoajax,
            success: function(data) {
                    console.log(data);
                    console.log(data.spanish_text);
                    if(data.length > 0 ){
                    var replacement = data[0].english_text + "·" + data[0].spanish_text ;
                    var iframe = document.getElementsByClassName("monelem_component");
                        var innerDoc1 = iframe[0].contentDocument.getElementsByClassName("calibreEbookContent");
                                var innerDoc = innerDoc1[0];
<<<<<<< HEAD
=======






>>>>>>> origin/master
                    htmlreplace(sel, replacement, innerDoc, last_child, first_child);
                    }
            },
            failure: function(data) {
                alert('Got an error dude');
            }
        });
        });
                reader2.listen(
                    'monocle:pagechange',
                    function (evt) {
                        if (isNaN (evt.m.pageNumber)){evt.m.pageNumber = 0}
                        pageNumber.update(evt.m.page, evt.m.pageNumber);
                        var info = evt.m;
                        var page_place = reader2.getPlace();
                        console.log("page_place info");
                        var position_percentage = page_place.percentAtTopOfPage();
                        if (isNaN (position_percentage)){position_percentage =0}
                        console.log(position_percentage);
                        var page_percentage = page_place.pageSizePercentage();
                        console.log(page_percentage);
                        var datoajax = {position_percentage:position_percentage, page_percentage:page_percentage};
                        console.log("datoajax");
                        console.log(datoajax);
                        //box_scrapping.getVisibleElem(rdr);
                        $.ajax({
                            url: '/wordajax/' ,
                            type: 'GET', // This is the default though, you don't actually need to always mention it
                            data: datoajax,
                            success: function(data) {
                                console.log("success");
                                },
                            failure: function(data) {
                                alert('Got an error dude');
                                }
                        });
                    }
                );
                function alertIfComponentNotFound(rdr) {
                    rdr.listen('monocle:notfound', function () { alert('Not found.') });
                    }
                }
                );
            }
        );
    </script>

    <script type="text/javascript">
     // Monocle.DEBUG = true;
      //var bookData = Monocle.bookDataFromIds(['part1', 'part2']);
      // Initialize the reader element.
      /*
      Monocle.Events.listen(
        window,
        'load',
        function () {
          // MARGINAL
          /*
          window.reader2 = Monocle.Reader(
            'marginal',
            bookData,
            { panels: Monocle.Panels.Marginal, flipper: Monocle.Flippers.Instant }
          );
          */
          /*
          // I-MODE
          window.reader3 = Monocle.Reader(
            'imode',
            bookData,
            { panels: Monocle.Panels.IMode }
          );
          // EINK
          window.reader3 = Monocle.Reader(
            'eInk',
            bookData,
            { panels: Monocle.Panels.eInk, flipper: Monocle.Flippers.Instant }
          );
          // MAGIC
          window.reader4 = Monocle.Reader(
            'magic',
            bookData,
            { panels: Monocle.Panels.Magic }
          );
          */
        //}
     // );
    </script>

  </head>

  <body>



    <div class="readerInfo">
      <h2>Marginal</h2>
      <div class="reader" id="marginal"></div>
      <p>
        Two panels, the same width as the page margins.
      </p>
    </div>


</body>
</html>